<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام تسجيل الموظف</title>
    <script>
        const companyLat = 36.217; // خط العرض لموقع الشركة
        const companyLng = 44.008; // خط الطول لموقع الشركة
        const radius = 1000; // 1000 متر

        function saveName() {
            const name = document.getElementById("employeeName").value;
            if (name) {
                localStorage.setItem("employeeName", name);
                alert("تم التسجيل بنجاح!");
                checkSession();
            } else {
                alert("يرجى إدخال الاسم الثنائي.");
            }
        }

        function checkSession() {
            const name = localStorage.getItem("employeeName");
            const formDiv = document.getElementById("formDiv");
            const buttonsDiv = document.getElementById("buttonsDiv");

            if (name) {
                formDiv.style.display = "none";
                buttonsDiv.style.display = "block";
                document.getElementById("welcome").innerText = `مرحبًا ${name}!`;
            } else {
                formDiv.style.display = "block";
                buttonsDiv.style.display = "none";
            }
        }

        function getLocation(action) {
            navigator.geolocation.getCurrentPosition(position => {
                const { latitude, longitude } = position.coords;
                const distance = calculateDistance(latitude, longitude, companyLat, companyLng);
                if (distance <= radius) {
                    saveToGoogleSheet(action);
                } else {
                    alert("أنت خارج نطاق موقع الشركة.");
                }
            });
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // نصف قطر الأرض بالمتر
            const φ1 = lat1 * Math.PI / 180;
            const φ2 = lat2 * Math.PI / 180;
            const Δφ = (lat2 - lat1) * Math.PI / 180;
            const Δλ = (lon2 - lon1) * Math.PI / 180;

            const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
                      Math.cos(φ1) * Math.cos(φ2) *
                      Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            return R * c; // المسافة بالمتر
        }

        function saveToGoogleSheet(action) {
            const name = localStorage.getItem("employeeName");
            const time = new Date().toLocaleString();
            //https://docs.google.com/spreadsheets/d/1o8qLqtOANKxHy8goHWXgt5q2YBYDcbqJGPYI5nUsl-g/edit?usp=sharing
            alert(`تم تسجيل ${action}. الاسم: ${name}, الوقت: ${time}`);
        }
    </script>
</head>
<body onload="checkSession()">
    <div id="formDiv">
        <h2>تسجيل الاسم الثنائي</h2>
        <input type="text" id="employeeName" placeholder="أدخل الاسم الثنائي">
        <button onclick="saveName()">تسجيل</button>
    </div>
    <div id="buttonsDiv" style="display:none;">
        <h2 id="welcome"></h2>
        <button onclick="getLocation('الدخول')">الدخول إلى الشركة</button>
        <button onclick="getLocation('الخروج')">الخروج من الشركة</button>
    </div>
</body>
</html>